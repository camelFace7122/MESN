!function(){"use strict";function e(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];$("".concat(e?e+" ":"","p.error")).remove(),$("".concat(e?e+" ":"","input")).removeClass("error"),$("".concat(e?e+" ":"","p.success")).remove(),$("".concat(e?e+" ":"","input")).removeClass("success"),$("".concat(e?e+" ":"",'div[name=""].error')).remove(),$("".concat(e?e+" ":"",'div[name=""].success')).remove(),$("".concat(e?e+" ":"","div[name]")).removeClass("error"),$("".concat(e?e+" ":"","div[name]")).removeClass("success"),$("".concat(e?e+" ":"","textarea")).removeClass("error"),$("".concat(e?e+" ":"","textarea")).removeClass("success"),t&&($("".concat(e?e+" ":"","input")).val(""),$("".concat(e?e+" ":"","div[name]")).html(""))}$((function(){var t=!1;$(".switch-btn").on("click",(function(o){o.preventDefault(),t?(t=!1,e(".auth",!0),e(".register",!0),$(".auth").show("slow"),$(".register").hide()):(t=!0,e(".auth",!0),e(".register",!0),$(".register").show("slow"),$(".auth").hide())})),$("input, textarea, div").on("focus",(function(t){t.target.closest("form")&&e("."+t.target.closest("form").classList[0])})),$(".register-btn").on("click",(function(t){t.preventDefault();var o={login:$("#register-login").val(),password:$("#register-password").val(),passwordConfirm:$("#register-passwordConfirm").val()};e(".register"),$.ajax("api/auth/register",{type:"POST",contentType:"application/json",data:JSON.stringify(o)}).done((function(e){e.ok?($(".register h2").after('<p class="success">Пользователь успешно зарегистрирован</p>'),$(location).attr("href","/")):($(".register h2").after('<p class="error">'+e.error+"</p>"),e.fields&&e.fields.forEach((function(e){$('input[name="'.concat(e,'"]')).addClass("error")})))}))})),$(".login-btn").on("click",(function(t){t.preventDefault();var o={login:$("#auth-login").val(),password:$("#auth-password").val()};e(".auth"),$.ajax("api/auth/login",{type:"POST",contentType:"application/json",data:JSON.stringify(o)}).done((function(e){e.ok?$(location).attr("href","/"):($(".auth h2").after('<p class="error">'+e.error+"</p>"),e.fields&&e.fields.forEach((function(e){$('input[name="'.concat(e,'"]')).addClass("error")})))}))}))})),$((function(){$(".publish-btn, .save-btn").on("click",(function(t){t.preventDefault();var o=t.target.classList.contains("save-btn"),a={title:$("#post-title").val(),body:$("#post-body").val(),isDraft:o,postId:$("#post-id").val()};e(".post-form"),$.ajax("/post/add",{type:"POST",contentType:"application/json",data:JSON.stringify(a)}).done((function(e){console.log(e),e.ok?o?$(location).attr("href","/post/edit/"+e.post.id):$(location).attr("href","/posts/"+e.post.url):($(".post-form h2").after('<p class="error">'+e.error+"</p>"),e.fields&&e.fields.forEach((function(e){$('input[name="'.concat(e,'"]')).addClass("error"),$('textarea[name="'.concat(e,'"]')).addClass("error")})))}))}))})),$((function(){var e,t;function o(o,a){if($(".reply").show(),e&&e.remove(),t=null,e=$("form.comment").clone(!0,!0),o)e.appendTo(".comments-list"),$(e).find(".cancel").hide();else{var n=$(a).parent();t=n.data("id"),$(a).after(e)}e.css({display:"flex"})}o(!0),$(".reply").on("click",(function(){o(!1,this),$(this).hide()})),$("form.comment .cancel").on("click",(function(t){t.preventDefault(),e&&e.remove(),o(!0)})),$("form.comment .send").on("click",(function(a){var n=this;a.preventDefault(),$(this).prop("disabled",!0);var r={body:e.find("textarea").val(),post:$(".comments").data("id"),parent:t};$.ajax("/comment/add",{type:"POST",contentType:"application/json",data:JSON.stringify(r)}).done((function(t){if($(n).prop("disabled",!1),t.ok){var a='\n                    <ul>\n                        <li style="background-color: #ffffe0;">\n                            <div class="head">\n                                <a href="/users/'.concat(t.login,'" class="link">').concat(t.login,'</a>\n                                <span class="date">Только что</span>\n                            </div>\n                            ').concat(t.body,"\n                        </li>\n                    </ul>\n                ");$(e).closest("li").append(a),o(!0)}else t.error||(t.error="Неизвестная ошибка",$(e).prepend('<p class="error">'+t.error+"</p>"))}))}))})),$((function(){$("#fileinfo").on("submit",(function(e){e.preventDefault();var t=new FormData(this);$.ajax({type:"POST",url:"/upload/image",contentType:!1,processData:!1,data:t,success:function(e){console.log(e)},error:function(e){console.log(e)}})}))}))}();